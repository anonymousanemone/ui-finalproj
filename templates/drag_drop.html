{% extends "layout.html" %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='egg-swap.css') }}">

<div class="egg-swap-container">
    <div class="left-panel">
		<img src="{{ url_for('static', filename='images/egg.png') }}" alt="Egg" class="egg-icon">
		<div class="post-it-box">
			<h1>Drag and Drop to match the function!
			</h1>
      	</div>
		<a href="/learn/{{ back_index }}" class="btn btn-purple">BACK</a>
		<a href="/learn/{{ next_index }}" class="btn btn-purple">NEXT</a>
    </div>
  
    <div class="right-panel">
        <div id="itemPool" class="dropzone question-bubble">
			{% for drag in contents.drag_drop.drags %}
			<div class="draggable-item" data-id="{{drag}}">{{drag}}</div>
			{% endfor %}
        </div>
  
		<div class="row">
			{% for drop in contents.drag_drop.drops %}
			<div class="col">
				<h5>{{drop}}</h5>
				<div class="dropzone" id="{{drop}}"></div>
			</div>
			{% endfor %}
		</div>
	</div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
<script>
  $(function () {
    function checkSubmit() {
      if ($('#itemPool .draggable-item').length === 0) {
        $('#submitBtn').prop('disabled', false);
      } else {
        $('#submitBtn').prop('disabled', true);
      }
    }

    function getBoxItemCount($box) {
      return $box.children('.draggable-item').length;
    }

    $(".draggable-item").draggable({
      revert: "invalid",
      helper: "clone",
      start: function (event, ui) {
        $(this).css('opacity', '0.5');
      },
      stop: function (event, ui) {
        $(this).css('opacity', '1');
      }
    });

    $(".dropzone").droppable({
      accept: ".draggable-item",
      drop: function (event, ui) {
        const $dropped = $(ui.draggable);
        const $clone = $dropped.clone();
        const $target = $(this);

        // Check if dropping back into original pool
        if ($target.attr('id') === 'itemPool') {
          $dropped.detach().appendTo($target);
        } else {
          if (getBoxItemCount($target) >= 2) {
            return;
          }
          // Remove original if moved from pool or another box
          const original = $('[data-id="' + $dropped.data('id') + '"]');
          original.remove();

          $clone.removeClass('ui-draggable-dragging');
          $clone.appendTo($target);
          makeDraggable($clone);
        }

        checkSubmit();
      }
    });

    function makeDraggable($item) {
      $item.draggable({
        revert: "invalid",
        helper: "clone",
        start: function (event, ui) {
          $(this).css('opacity', '0.5');
        },
        stop: function (event, ui) {
          $(this).css('opacity', '1');
        }
      });
    }

    $('#submitBtn').on('click', function () {
      alert("Submitted!");
    });
  });
</script>

{% endblock %}
